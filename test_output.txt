
[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mC:/Users/gates/Personal/Interactive-Video-Character[39m

[90mstdout[2m | src/services/tests/latencyOptimizations.test.ts[2m > [22m[2mLatency Optimizations - Phase 1[2m > [22m[2mOptimization 1: Parallelize Intent + Context Fetch (buildSystemPrompt)[2m > [22m[2mshould use pre-fetched context instead of calling fetchers when provided
[22m[39mâœ… [buildSystemPrompt] Using pre-fetched context
[PresenceDirector] Parsed 6 opinions from character profile

[90mstdout[2m | src/services/tests/latencyOptimizations.test.ts[2m > [22m[2mLatency Optimizations - Phase 1[2m > [22m[2mOptimization 1: Parallelize Intent + Context Fetch (buildSystemPrompt)[2m > [22m[2mshould fallback to calling fetchers when pre-fetched context is NOT provided
[22m[39mâš ï¸ [buildSystemPrompt] No pre-fetched context, fetching now

[90mstdout[2m | src/services/tests/latencyOptimizations.test.ts[2m > [22m[2mLatency Optimizations - Phase 1[2m > [22m[2mOptimization 2: Reduce Intent Detection Time (Tiered Detection)[2m > [22m[2mshould skip LLM call for Tier 1 (Very short messages)
[22m[39mâš¡ [IntentService] SKIP: Very short message: "hi"

[90mstdout[2m | src/services/tests/latencyOptimizations.test.ts[2m > [22m[2mLatency Optimizations - Phase 1[2m > [22m[2mOptimization 2: Reduce Intent Detection Time (Tiered Detection)[2m > [22m[2mshould skip LLM call for Tier 2 (Simple message patterns)
[22m[39mâš¡ [IntentService] SKIP: Simple message pattern: "lol that's funny"

[90mstdout[2m | src/services/tests/latencyOptimizations.test.ts[2m > [22m[2mLatency Optimizations - Phase 1[2m > [22m[2mOptimization 2: Reduce Intent Detection Time (Tiered Detection)[2m > [22m[2mshould NOT skip LLM call for Tier 3 (Complex messages)
[22m[39mğŸ§  [IntentService] UNIFIED INTENT DETECTED { tone: [32m'happy'[39m, genuine: [33mfalse[39m, topics: [], loop: [33mfalse[39m }

[90mstdout[2m | src/services/tests/latencyOptimizations.test.ts[2m > [22m[2mLatency Optimizations - Phase 1[2m > [22m[2mOptimization 3: Pre-fetch on Idle[2m > [22m[2mshould call fetchers to warm the cache
[22m[39mğŸ”¥ [StateService] Warming context cache for user: test-user
âœ… [StateService] Cache warmed in 0ms

 [32mâœ“[39m src/services/tests/latencyOptimizations.test.ts[2m > [22mLatency Optimizations - Phase 1[2m > [22mOptimization 1: Parallelize Intent + Context Fetch (buildSystemPrompt)[2m > [22mshould use pre-fetched context instead of calling fetchers when provided
 [32mâœ“[39m src/services/tests/latencyOptimizations.test.ts[2m > [22mLatency Optimizations - Phase 1[2m > [22mOptimization 1: Parallelize Intent + Context Fetch (buildSystemPrompt)[2m > [22mshould fallback to calling fetchers when pre-fetched context is NOT provided
 [32mâœ“[39m src/services/tests/latencyOptimizations.test.ts[2m > [22mLatency Optimizations - Phase 1[2m > [22mOptimization 2: Reduce Intent Detection Time (Tiered Detection)[2m > [22mshould skip LLM call for Tier 1 (Very short messages)
 [32mâœ“[39m src/services/tests/latencyOptimizations.test.ts[2m > [22mLatency Optimizations - Phase 1[2m > [22mOptimization 2: Reduce Intent Detection Time (Tiered Detection)[2m > [22mshould skip LLM call for Tier 2 (Simple message patterns)
 [32mâœ“[39m src/services/tests/latencyOptimizations.test.ts[2m > [22mLatency Optimizations - Phase 1[2m > [22mOptimization 2: Reduce Intent Detection Time (Tiered Detection)[2m > [22mshould NOT skip LLM call for Tier 3 (Complex messages)
 [31mÃ—[39m src/services/tests/latencyOptimizations.test.ts[2m > [22mLatency Optimizations - Phase 1[2m > [22mOptimization 3: Pre-fetch on Idle[2m > [22mshould call fetchers to warm the cache
[31m   â†’ expected "spy" to be called with arguments: [ 'presence_contexts' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m

[31mâ¯â¯â¯â¯â¯â¯â¯[1m[7m Failed Tests 1 [27m[22mâ¯â¯â¯â¯â¯â¯â¯[39m

[31m[1m[7m FAIL [27m[22m[39m src/services/tests/latencyOptimizations.test.ts[2m > [22mLatency Optimizations - Phase 1[2m > [22mOptimization 3: Pre-fetch on Idle[2m > [22mshould call fetchers to warm the cache
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'presence_contexts' ][90m

Received: 

[31m[90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m src/services/tests/latencyOptimizations.test.ts:[2m297:29[22m[39m
    [90m295| [39m      
    [90m296| [39m      [90m// Verify getPresenceContext side effect (Table call)[39m
    [90m297| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m'presence_contexts'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m298| [39m    })[33m;[39m
    [90m299| [39m  })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (6)[39m
[2m   Start at [22m 11:03:34
[2m   Duration [22m 895ms[2m (transform 211ms, setup 0ms, collect 503ms, tests 23ms, environment 0ms, prepare 99ms)[22m

